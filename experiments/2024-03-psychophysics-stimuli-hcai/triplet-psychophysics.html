<!DOCTYPE html>
<html>

<head>
    <title>WM updating task</title>
    <script src="jspsych-dist/dist/jspsych.js"></script>
    <script src="jspsych-dist/dist/plugin-html-button-response.js"></script>
    <script src="jspsych-dist/dist/plugin-html-keyboard-response.js"></script>
    <script src="jspsych-dist/dist/plugin-preload.js"></script>
    <script src="jspsych-dist/dist/plugin-survey-text.js"></script>
    <script src="jspsych-dist/dist/plugin-survey-multi-choice.js"></script>
    <script src="jspsych-dist/dist/plugin-fullscreen.js"></script>
    <script src="https://pixijs.download/release/pixi.js"></script>
    <script src="jquery.min.js"></script>
    <script src="js-helpers.js"></script>
    <script src="jspsych-psychophysics.js"></script>
    <link rel="stylesheet" href="jspsych-dist/dist/jspsych.css">
    </link>
    <script srf="jspsych-psychophysics.js"></script>
</head>


<body></body>
<script>
    const jsPsych = initJsPsych({
        show_progress_bar: true,
        auto_update_progress_bar: false,
        on_finish: function () {
            jsPsych.data.displayData();
        }
    })

    const pixi_flag = jsPsych.data.getURLVariable('pixi_flag') === '1' ? true : false;

    var instructionsGo = {
        type: jsPsychHtmlButtonResponse,
        stimulus: '<div style="font-size:30px;"><br>Click on "Next" to start.<br><br></div>',
        choices: ["Next"]
    };

    var instructions1 = {
        type: jsPsychHtmlButtonResponse,
        stimulus: '<div style="font-size:30px;"><b>INSTRUCTIONS</b><br><br><br>This is the updating task. It has two parts: <br><br>(1) Memorization of the initially presented digits <br><br>(2) Individually updating selected digits <br><br><br><br>This task is going to be in full-screen mode.<br><br><b> Please do not leave the full-screen mode. <br><br>Otherwise, the presented numbers may be illegible.<br><br></div>',
        choices: ["Next"]
    };

    var instructions_test = {
        type: jsPsychHtmlButtonResponse,
        stimulus: '<div style="font-size:30px;">These were the two practice trials.<br><br>The main part of the updating task is going to start now.<br>Good luck. </div>',
        choices: ["Start Main Part"]
    };

    var data_cumulative = [];


    const head_trials = {
        timeline: [
            {
                type: jsPsychPsychophysics,
                pixi: pixi_flag,
                stimuli: [
                    {
                        obj_type: 'image',
                        scale: .55,
                        file: jsPsych.timelineVariable('upleftImage'),
                        show_start_time: 250, // ms after the start of the trial
                        startX: screen.width / 2 - 150,
                        startY: screen.height / 2 - 300
                    },
                    {
                        obj_type: 'image',
                        scale: .55,
                        file: jsPsych.timelineVariable('uprightImage'),
                        show_start_time: 250, // ms after the start of the trial
                        startX: screen.width / 2 + 150,
                        startY: screen.height / 2 - 300
                    },
                    {
                        obj_type: 'image',
                        scale: .55,
                        file: jsPsych.timelineVariable('lomidImage'),
                        show_start_time: 250, // ms after the start of the trial
                        startX: screen.width / 2,
                        startY: screen.height / 2 - 50
                    }
                ],
                canvas_height: 700,
                prompt: 'Press "f" or "j" to respond.',
                data: {
                    'upleftImage': jsPsych.timelineVariable('upleftImage'),
                    'uprightImage': jsPsych.timelineVariable('uprightImage'),
                    'lomidImage': jsPsych.timelineVariable('lomidImage')
                }
            }
        ],
        timeline_variables: timeline_variables_head,
        randomize_order: false,
        choices: ["f", "j"],
        on_finish: function (data) {
            var response_recoded;
            if (data.response == "f") response_recoded = 0;
            if (data.response == "j") response_recoded = 1;

            data_similarity = {
                participant_id: participant_id,
                is_practice: is_practice,
                stimulus_ids: jsPsych.timelineVariable('stimulus_ids'),
                trial_id: jsPsych.timelineVariable('trial_id'),
                id_left: jsPsych.timelineVariable("id_left_probe"),
                id_right: jsPsych.timelineVariable("id_right_probe"),
                id_target: jsPsych.timelineVariable("id_target"),
                response: response_recoded,
                rt: data.rt
            };
            data_cumulative.push(data_similarity);
            console.log("data_similarity = ", data_similarity);

            // update progress bar
            if (is_practice == 0) {
                jsPsych.setProgressBar(jsPsych.timelineVariable('trial_id') / n_trials_per_dim);
            }
        }
    }

    jsPsych.run([preload, instruction, head_trials]);
    file_name = null // file name for data file. if null, a default name consisting of the participant ID and a unique number is chosen.
    local = false // save the data file locally.
    var n_comprehension_attempts = 1;

    var t_start = Date.now();

    //----------------------------------------------------------------------


    if (window.location.search.indexOf('PROLIFIC_PID') > -1) {
        var participant_id = getQueryVariable('PROLIFIC_PID');
    }
    // If no ID is present, generate one using random numbers - this is useful for testing
    else {
        var participant_id = Math.floor(Math.random() * 1000);
    }
    // STUDY ID
    if (window.location.search.indexOf('STUDY_ID') > -1) {
        var studyID = getQueryVariable('STUDY_ID');
    }
    progress_url = updateQueryStringParameter("../../task/main.html", "PROLIFIC_PID", participant_id);


</script>

</html>